<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>MR Pharma Tools â€“ Tablet % Friability</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js" defer></script>
<style>
body {
  font-family: "Times New Roman", Times, serif;
  background: #ffffff;
  max-width: 1200px;
  margin: auto;
  padding: 20px;
}
h2 { color: #1f3c88; margin-bottom: 5px; }
p.note { font-size: 14px; color: #555555; background: #f5f7fb; padding: 8px; border-left: 5px solid #1f3c88; }
.container { display: flex; gap: 25px; flex-wrap: wrap; }
.left-panel { width: 50%; min-width: 320px; }
.right-panel { width: 50%; min-width: 320px; border-left: 2px solid #f0f0f0; padding-left: 20px; }
input { width: 80%; margin-bottom: 10px; font-family: "Times New Roman", Times, serif; padding: 5px; }
button { margin-top: 10px; padding: 7px 14px; background: #1f3c88; color: #fff; border: none; cursor: pointer; font-family: "Times New Roman", Times, serif; }
#resultBox { margin-top: 15px; padding: 12px; display: none; background: #f5f7fb; border-left: 6px solid #1f3c88; }
#plot { height: 420px; margin-top: 15px; }
label { display:block; margin-top: 10px; font-weight:bold; }
</style>
</head>
<body>

<h2>Tablet % Friability Calculator</h2>
<p class="note">Note: Dust should be carefully removed from the tablets prior to testing or measuring Initial weight and Final Weight.</p>

<div class="container">
  <div class="left-panel">
    <label for="wi">Initial Weight of Tablets (Wi, g)</label>
    <input type="number" id="wi" step="0.001" value="6.5">
    
    <label for="wf">Final Weight of Tablets (Wf, g)</label>
    <input type="number" id="wf" step="0.001" value="6.45">
    
    <label for="tabWeight">Individual Tablet Weight (mg)</label>
    <input type="number" id="tabWeight" step="1" value="500">
    
    <button onclick="calculateFriability()">Calculate</button>
    <button onclick="exportExcel()">Download Excel</button>
    
    <div id="resultBox"></div>
  </div>
  
  <div class="right-panel">
    <div id="plot"></div>
  </div>
</div>

<script>
// Calculate sample size
function sampleSize(indivWeight) {
  if (indivWeight <= 650) {
    return Math.ceil(6.5 / (indivWeight/1000)); // convert mg to g
  } else {
    return 10;
  }
}

// Calculate friability
function calculateFriability() {
  let wi = parseFloat(document.getElementById("wi").value);
  let wf = parseFloat(document.getElementById("wf").value);
  let tabWeight = parseFloat(document.getElementById("tabWeight").value);
  
  if (isNaN(wi) || isNaN(wf) || isNaN(tabWeight)) {
    alert("Please enter valid numeric values.");
    return;
  }
  if (wi <= 0 || wf <= 0 || tabWeight <= 0) {
    alert("Values must be greater than zero.");
    return;
  }
  
  let friability = ((wi - wf)/wi)*100;
  let size = sampleSize(tabWeight);
  let passFail = friability < 1 ? "Pass" : "Fail";
  
  document.getElementById("resultBox").style.display = "block";
  document.getElementById("resultBox").innerHTML = `
    <b>Sample Size:</b> ${size} tablets<br>
    <b>% Friability:</b> ${friability.toFixed(2)}%<br>
    <b>Result:</b> ${passFail}
  `;
  
  // Plot Wi vs Wf
  Plotly.newPlot("plot", [
    {x:["Initial Weight (Wi)","Final Weight (Wf)"], y:[wi,wf], type:"bar", marker:{color:["#1f3c88","#ff6f61"]}}
  ], {
    title:"Tablet Weight Comparison",
    yaxis:{title:"Weight (g)"}
  });
}

// Export Excel
function exportExcel() {
  let wi = parseFloat(document.getElementById("wi").value);
  let wf = parseFloat(document.getElementById("wf").value);
  let tabWeight = parseFloat(document.getElementById("tabWeight").value);
  let friability = ((wi - wf)/wi)*100;
  let size = sampleSize(tabWeight);
  let passFail = friability < 1 ? "Pass" : "Fail";
  
  let csv = [
    ["Initial Weight (g)", wi],
    ["Final Weight (g)", wf],
    ["Individual Tablet Weight (mg)", tabWeight],
    ["Sample Size (tablets)", size],
    ["% Friability", friability.toFixed(2)],
    ["Result", passFail]
  ].map(r=>r.join(",")).join("\n");
  
  let blob = new Blob([csv],{type:"application/vnd.ms-excel"});
  let a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download="Tablet_Friability.xls";
  a.click();
}
</script>

</body>
</html>
